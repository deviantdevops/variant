{"id":"N2Ne","dependencies":[{"name":"/home/hibberdk/Sites/XILOBYTE/variant/package.json","includedInParent":true,"mtime":1625901220329},{"name":"../util/crypt","loc":{"line":1,"column":26},"parent":"/home/hibberdk/Sites/XILOBYTE/variant/blockchain/block.js","resolved":"/home/hibberdk/Sites/XILOBYTE/variant/util/crypt.js"},{"name":"crypto","loc":{"line":2,"column":23},"parent":"/home/hibberdk/Sites/XILOBYTE/variant/blockchain/block.js","resolved":"/home/hibberdk/Sites/XILOBYTE/variant/node_modules/crypto-browserify/index.js"},{"name":"hex-to-binary","loc":{"line":3,"column":25},"parent":"/home/hibberdk/Sites/XILOBYTE/variant/blockchain/block.js","resolved":"/home/hibberdk/Sites/XILOBYTE/variant/node_modules/hex-to-binary/index.js"},{"name":"../util/database","loc":{"line":4,"column":21},"parent":"/home/hibberdk/Sites/XILOBYTE/variant/blockchain/block.js","resolved":"/home/hibberdk/Sites/XILOBYTE/variant/util/database.js"},{"name":"uuid","loc":{"line":6,"column":29},"parent":"/home/hibberdk/Sites/XILOBYTE/variant/blockchain/block.js","resolved":"/home/hibberdk/Sites/XILOBYTE/variant/node_modules/uuid/index.js"}],"generated":{"js":"var global = arguments[3];\nvar t=arguments[3];function e(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function a(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}var i=require(\"../util/crypt\"),r=require(\"crypto\"),c=require(\"hex-to-binary\"),o=require(\"../util/database\"),u=(new o).getInstance(),f=require(\"uuid\"),l=f.v1,s=function(){function a(t){var n=t.payload,i=t.hash;e(this,a),this.payload=n,this.payload.id=l(),this.hash=i}return n(a,null,[{key:\"genesis\",value:function(){return u.transactionGenesisBlock()}},{key:\"getLastBlock\",value:function(){return new Promise(function(t,e){t(u.transactionLastBlock())}).catch(function(t){reject(t)})}},{key:\"mineBlock\",value:function(t){return new Promise(function(e,n){var o,f=u.transactionLastBlock();t.id=l();do{t.created_at=Date.now(),t.nonce=r.randomBytes(16).toString(\"base64\"),t.difficulty=a.adjustDifficulty(t,f),t.lastHash=f.hash,o=i.hash(t,t.difficulty,t.nonce)}while(c(o).substr(0,t.difficulty)!==\"0\".repeat(t.difficulty));var s={payload:t,hash:o};e(u.transactionPutBlock(s))})}},{key:\"adjustDifficulty\",value:function(e,a){return e.difficulty=a.payload.difficulty||t.config.DIFFICULTY,e.created_at-a.payload.created_at<t.config.MINE_RATE?e.difficulty+1:e.created_at-a.payload.created_at>t.config.MINE_RATE?e.difficulty-1:0===e.difficulty?t.config.DIFFICULTY:void 0}}]),a}();module.exports=s;"},"sourceMaps":{"js":{"mappings":[{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":0}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":4}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":6}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":16}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":19}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":28}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":30}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":32}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":35}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":40}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":53}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":56}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":62}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":66}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":76}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":113}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":122}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":124}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":126}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":129}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":133}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":137}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":139}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":141}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":143}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":145}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":152}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":156}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":157}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":161}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":163}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":165}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":168}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":170}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":181}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":183}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":196}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":198}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":200}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":214}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":216}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":226}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":230}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":232}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":242}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":245}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":252}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":267}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":269}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":271}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":275}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":279}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":288}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":290}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":292}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":294}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":297}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":304}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":307}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":309}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":311}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":321}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":324}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":327}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":329}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":331}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":334}},{"source":"blockchain/block.js","original":{"line":1,"column":0},"generated":{"line":2,"column":336}},{"source":"blockchain/block.js","name":"CryptUtil","original":{"line":1,"column":6},"generated":{"line":2,"column":340}},{"source":"blockchain/block.js","name":"require","original":{"line":1,"column":18},"generated":{"line":2,"column":342}},{"source":"blockchain/block.js","original":{"line":1,"column":26},"generated":{"line":2,"column":350}},{"source":"blockchain/block.js","name":"CRPYTO","original":{"line":2,"column":6},"generated":{"line":2,"column":367}},{"source":"blockchain/block.js","name":"require","original":{"line":2,"column":15},"generated":{"line":2,"column":369}},{"source":"blockchain/block.js","original":{"line":2,"column":23},"generated":{"line":2,"column":377}},{"source":"blockchain/block.js","name":"HexToBin","original":{"line":3,"column":6},"generated":{"line":2,"column":387}},{"source":"blockchain/block.js","name":"require","original":{"line":3,"column":17},"generated":{"line":2,"column":389}},{"source":"blockchain/block.js","original":{"line":3,"column":25},"generated":{"line":2,"column":397}},{"source":"blockchain/block.js","name":"LMDB","original":{"line":4,"column":6},"generated":{"line":2,"column":414}},{"source":"blockchain/block.js","name":"require","original":{"line":4,"column":13},"generated":{"line":2,"column":416}},{"source":"blockchain/block.js","original":{"line":4,"column":21},"generated":{"line":2,"column":424}},{"source":"blockchain/block.js","name":"DB","original":{"line":5,"column":4},"generated":{"line":2,"column":444}},{"source":"blockchain/block.js","original":{"line":5,"column":9},"generated":{"line":2,"column":447}},{"source":"blockchain/block.js","name":"LMDB","original":{"line":5,"column":13},"generated":{"line":2,"column":451}},{"source":"blockchain/block.js","name":"getInstance","original":{"line":5,"column":20},"generated":{"line":2,"column":454}},{"source":"blockchain/block.js","name":"require","original":{"line":6,"column":21},"generated":{"line":2,"column":468}},{"source":"blockchain/block.js","name":"require","original":{"line":6,"column":21},"generated":{"line":2,"column":470}},{"source":"blockchain/block.js","original":{"line":6,"column":29},"generated":{"line":2,"column":478}},{"source":"blockchain/block.js","name":"uuid","original":{"line":6,"column":12},"generated":{"line":2,"column":486}},{"source":"blockchain/block.js","name":"v1","original":{"line":6,"column":8},"generated":{"line":2,"column":488}},{"source":"blockchain/block.js","name":"v1","original":{"line":6,"column":8},"generated":{"line":2,"column":490}},{"source":"blockchain/block.js","name":"Block","original":{"line":8,"column":6},"generated":{"line":2,"column":493}},{"source":"blockchain/block.js","name":"Block","original":{"line":8,"column":6},"generated":{"line":2,"column":495}},{"source":"blockchain/block.js","original":{"line":10,"column":33},"generated":{"line":2,"column":506}},{"source":"blockchain/block.js","original":{"line":10,"column":33},"generated":{"line":2,"column":515}},{"source":"blockchain/block.js","original":{"line":10,"column":33},"generated":{"line":2,"column":517}},{"source":"blockchain/block.js","name":"payload","original":{"line":10,"column":17},"generated":{"line":2,"column":520}},{"source":"blockchain/block.js","name":"payload","original":{"line":10,"column":17},"generated":{"line":2,"column":524}},{"source":"blockchain/block.js","name":"payload","original":{"line":10,"column":17},"generated":{"line":2,"column":526}},{"source":"blockchain/block.js","name":"payload","original":{"line":10,"column":17},"generated":{"line":2,"column":528}},{"source":"blockchain/block.js","name":"hash","original":{"line":10,"column":26},"generated":{"line":2,"column":536}},{"source":"blockchain/block.js","name":"hash","original":{"line":10,"column":26},"generated":{"line":2,"column":538}},{"source":"blockchain/block.js","name":"hash","original":{"line":10,"column":26},"generated":{"line":2,"column":540}},{"source":"blockchain/block.js","original":{"line":10,"column":33},"generated":{"line":2,"column":545}},{"source":"blockchain/block.js","original":{"line":10,"column":33},"generated":{"line":2,"column":547}},{"source":"blockchain/block.js","original":{"line":10,"column":33},"generated":{"line":2,"column":552}},{"source":"blockchain/block.js","name":"payload","original":{"line":12,"column":13},"generated":{"line":2,"column":555}},{"source":"blockchain/block.js","name":"payload","original":{"line":12,"column":13},"generated":{"line":2,"column":560}},{"source":"blockchain/block.js","name":"payload","original":{"line":12,"column":23},"generated":{"line":2,"column":568}},{"source":"blockchain/block.js","name":"payload","original":{"line":13,"column":13},"generated":{"line":2,"column":570}},{"source":"blockchain/block.js","name":"payload","original":{"line":13,"column":13},"generated":{"line":2,"column":575}},{"source":"blockchain/block.js","name":"id","original":{"line":13,"column":21},"generated":{"line":2,"column":583}},{"source":"blockchain/block.js","name":"uuid","original":{"line":13,"column":26},"generated":{"line":2,"column":586}},{"source":"blockchain/block.js","name":"hash","original":{"line":14,"column":13},"generated":{"line":2,"column":590}},{"source":"blockchain/block.js","name":"hash","original":{"line":14,"column":13},"generated":{"line":2,"column":595}},{"source":"blockchain/block.js","name":"hash","original":{"line":14,"column":20},"generated":{"line":2,"column":600}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":602}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":609}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":611}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":613}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":618}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":619}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":620}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":624}},{"source":"blockchain/block.js","original":{"line":18,"column":4},"generated":{"line":2,"column":634}},{"source":"blockchain/block.js","original":{"line":18,"column":4},"generated":{"line":2,"column":640}},{"source":"blockchain/block.js","name":"DB","original":{"line":19,"column":15},"generated":{"line":2,"column":651}},{"source":"blockchain/block.js","name":"DB","original":{"line":19,"column":15},"generated":{"line":2,"column":658}},{"source":"blockchain/block.js","name":"transactionGenesisBlock","original":{"line":19,"column":18},"generated":{"line":2,"column":660}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":688}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":689}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":693}},{"source":"blockchain/block.js","original":{"line":25,"column":4},"generated":{"line":2,"column":708}},{"source":"blockchain/block.js","original":{"line":25,"column":4},"generated":{"line":2,"column":714}},{"source":"blockchain/block.js","original":{"line":26,"column":15},"generated":{"line":2,"column":725}},{"source":"blockchain/block.js","original":{"line":26,"column":15},"generated":{"line":2,"column":732}},{"source":"blockchain/block.js","name":"Promise","original":{"line":26,"column":19},"generated":{"line":2,"column":736}},{"source":"blockchain/block.js","original":{"line":26,"column":27},"generated":{"line":2,"column":744}},{"source":"blockchain/block.js","name":"resolve","original":{"line":26,"column":28},"generated":{"line":2,"column":753}},{"source":"blockchain/block.js","name":"reject","original":{"line":26,"column":37},"generated":{"line":2,"column":755}},{"source":"blockchain/block.js","name":"resolve","original":{"line":27,"column":12},"generated":{"line":2,"column":758}},{"source":"blockchain/block.js","name":"DB","original":{"line":27,"column":20},"generated":{"line":2,"column":760}},{"source":"blockchain/block.js","name":"transactionLastBlock","original":{"line":27,"column":23},"generated":{"line":2,"column":762}},{"source":"blockchain/block.js","name":"catch","original":{"line":28,"column":11},"generated":{"line":2,"column":788}},{"source":"blockchain/block.js","original":{"line":28,"column":18},"generated":{"line":2,"column":794}},{"source":"blockchain/block.js","name":"err","original":{"line":28,"column":18},"generated":{"line":2,"column":803}},{"source":"blockchain/block.js","name":"reject","original":{"line":29,"column":12},"generated":{"line":2,"column":806}},{"source":"blockchain/block.js","name":"err","original":{"line":29,"column":19},"generated":{"line":2,"column":813}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":820}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":821}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":825}},{"source":"blockchain/block.js","original":{"line":37,"column":4},"generated":{"line":2,"column":837}},{"source":"blockchain/block.js","original":{"line":37,"column":4},"generated":{"line":2,"column":843}},{"source":"blockchain/block.js","name":"payload","original":{"line":37,"column":23},"generated":{"line":2,"column":852}},{"source":"blockchain/block.js","original":{"line":38,"column":15},"generated":{"line":2,"column":855}},{"source":"blockchain/block.js","original":{"line":38,"column":15},"generated":{"line":2,"column":862}},{"source":"blockchain/block.js","name":"Promise","original":{"line":38,"column":19},"generated":{"line":2,"column":866}},{"source":"blockchain/block.js","original":{"line":38,"column":27},"generated":{"line":2,"column":874}},{"source":"blockchain/block.js","name":"resolve","original":{"line":38,"column":28},"generated":{"line":2,"column":883}},{"source":"blockchain/block.js","name":"reject","original":{"line":38,"column":37},"generated":{"line":2,"column":885}},{"source":"blockchain/block.js","name":"hash","original":{"line":39,"column":16},"generated":{"line":2,"column":888}},{"source":"blockchain/block.js","name":"hash","original":{"line":39,"column":16},"generated":{"line":2,"column":892}},{"source":"blockchain/block.js","name":"lastBlock","original":{"line":40,"column":16},"generated":{"line":2,"column":894}},{"source":"blockchain/block.js","name":"DB","original":{"line":40,"column":28},"generated":{"line":2,"column":896}},{"source":"blockchain/block.js","name":"transactionLastBlock","original":{"line":40,"column":31},"generated":{"line":2,"column":898}},{"source":"blockchain/block.js","name":"payload","original":{"line":41,"column":12},"generated":{"line":2,"column":921}},{"source":"blockchain/block.js","name":"id","original":{"line":41,"column":20},"generated":{"line":2,"column":923}},{"source":"blockchain/block.js","name":"uuid","original":{"line":41,"column":25},"generated":{"line":2,"column":926}},{"source":"blockchain/block.js","original":{"line":42,"column":15},"generated":{"line":2,"column":930}},{"source":"blockchain/block.js","name":"payload","original":{"line":43,"column":16},"generated":{"line":2,"column":933}},{"source":"blockchain/block.js","name":"created_at","original":{"line":43,"column":24},"generated":{"line":2,"column":935}},{"source":"blockchain/block.js","name":"Date","original":{"line":43,"column":37},"generated":{"line":2,"column":946}},{"source":"blockchain/block.js","name":"now","original":{"line":43,"column":42},"generated":{"line":2,"column":951}},{"source":"blockchain/block.js","name":"payload","original":{"line":44,"column":16},"generated":{"line":2,"column":957}},{"source":"blockchain/block.js","name":"nonce","original":{"line":44,"column":24},"generated":{"line":2,"column":959}},{"source":"blockchain/block.js","name":"CRPYTO","original":{"line":44,"column":32},"generated":{"line":2,"column":965}},{"source":"blockchain/block.js","name":"randomBytes","original":{"line":44,"column":39},"generated":{"line":2,"column":967}},{"source":"blockchain/block.js","original":{"line":44,"column":51},"generated":{"line":2,"column":979}},{"source":"blockchain/block.js","name":"toString","original":{"line":44,"column":55},"generated":{"line":2,"column":983}},{"source":"blockchain/block.js","original":{"line":44,"column":64},"generated":{"line":2,"column":992}},{"source":"blockchain/block.js","name":"payload","original":{"line":45,"column":16},"generated":{"line":2,"column":1002}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":45,"column":24},"generated":{"line":2,"column":1004}},{"source":"blockchain/block.js","name":"Block","original":{"line":45,"column":37},"generated":{"line":2,"column":1015}},{"source":"blockchain/block.js","name":"adjustDifficulty","original":{"line":45,"column":43},"generated":{"line":2,"column":1017}},{"source":"blockchain/block.js","name":"payload","original":{"line":45,"column":60},"generated":{"line":2,"column":1034}},{"source":"blockchain/block.js","name":"lastBlock","original":{"line":45,"column":69},"generated":{"line":2,"column":1036}},{"source":"blockchain/block.js","name":"payload","original":{"line":46,"column":16},"generated":{"line":2,"column":1039}},{"source":"blockchain/block.js","name":"lastHash","original":{"line":46,"column":24},"generated":{"line":2,"column":1041}},{"source":"blockchain/block.js","name":"lastBlock","original":{"line":46,"column":35},"generated":{"line":2,"column":1050}},{"source":"blockchain/block.js","name":"hash","original":{"line":46,"column":45},"generated":{"line":2,"column":1052}},{"source":"blockchain/block.js","name":"hash","original":{"line":47,"column":16},"generated":{"line":2,"column":1057}},{"source":"blockchain/block.js","name":"CryptUtil","original":{"line":47,"column":23},"generated":{"line":2,"column":1059}},{"source":"blockchain/block.js","name":"hash","original":{"line":47,"column":33},"generated":{"line":2,"column":1061}},{"source":"blockchain/block.js","name":"payload","original":{"line":47,"column":38},"generated":{"line":2,"column":1066}},{"source":"blockchain/block.js","name":"payload","original":{"line":47,"column":47},"generated":{"line":2,"column":1068}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":47,"column":55},"generated":{"line":2,"column":1070}},{"source":"blockchain/block.js","name":"payload","original":{"line":47,"column":67},"generated":{"line":2,"column":1081}},{"source":"blockchain/block.js","name":"nonce","original":{"line":47,"column":75},"generated":{"line":2,"column":1083}},{"source":"blockchain/block.js","name":"HexToBin","original":{"line":48,"column":20},"generated":{"line":2,"column":1096}},{"source":"blockchain/block.js","name":"hash","original":{"line":48,"column":29},"generated":{"line":2,"column":1098}},{"source":"blockchain/block.js","name":"substr","original":{"line":48,"column":35},"generated":{"line":2,"column":1101}},{"source":"blockchain/block.js","original":{"line":48,"column":42},"generated":{"line":2,"column":1108}},{"source":"blockchain/block.js","name":"payload","original":{"line":48,"column":45},"generated":{"line":2,"column":1110}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":48,"column":53},"generated":{"line":2,"column":1112}},{"source":"blockchain/block.js","original":{"line":48,"column":69},"generated":{"line":2,"column":1126}},{"source":"blockchain/block.js","name":"repeat","original":{"line":48,"column":73},"generated":{"line":2,"column":1130}},{"source":"blockchain/block.js","name":"payload","original":{"line":48,"column":80},"generated":{"line":2,"column":1137}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":48,"column":88},"generated":{"line":2,"column":1139}},{"source":"blockchain/block.js","name":"block","original":{"line":49,"column":16},"generated":{"line":2,"column":1152}},{"source":"blockchain/block.js","name":"block","original":{"line":49,"column":16},"generated":{"line":2,"column":1156}},{"source":"blockchain/block.js","original":{"line":49,"column":24},"generated":{"line":2,"column":1158}},{"source":"blockchain/block.js","name":"payload","original":{"line":50,"column":16},"generated":{"line":2,"column":1159}},{"source":"blockchain/block.js","name":"payload","original":{"line":50,"column":26},"generated":{"line":2,"column":1167}},{"source":"blockchain/block.js","name":"hash","original":{"line":51,"column":16},"generated":{"line":2,"column":1169}},{"source":"blockchain/block.js","name":"hash","original":{"line":51,"column":16},"generated":{"line":2,"column":1174}},{"source":"blockchain/block.js","name":"resolve","original":{"line":53,"column":12},"generated":{"line":2,"column":1177}},{"source":"blockchain/block.js","name":"DB","original":{"line":53,"column":20},"generated":{"line":2,"column":1179}},{"source":"blockchain/block.js","name":"transactionPutBlock","original":{"line":53,"column":23},"generated":{"line":2,"column":1181}},{"source":"blockchain/block.js","name":"block","original":{"line":53,"column":43},"generated":{"line":2,"column":1201}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":1209}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":1210}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":1214}},{"source":"blockchain/block.js","original":{"line":62,"column":4},"generated":{"line":2,"column":1233}},{"source":"blockchain/block.js","original":{"line":62,"column":4},"generated":{"line":2,"column":1239}},{"source":"blockchain/block.js","name":"payload","original":{"line":62,"column":29},"generated":{"line":2,"column":1248}},{"source":"blockchain/block.js","name":"lastBlock","original":{"line":62,"column":38},"generated":{"line":2,"column":1250}},{"source":"blockchain/block.js","name":"payload","original":{"line":65,"column":13},"generated":{"line":2,"column":1253}},{"source":"blockchain/block.js","name":"payload","original":{"line":64,"column":8},"generated":{"line":2,"column":1260}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":64,"column":16},"generated":{"line":2,"column":1262}},{"source":"blockchain/block.js","name":"lastBlock","original":{"line":64,"column":29},"generated":{"line":2,"column":1273}},{"source":"blockchain/block.js","name":"payload","original":{"line":64,"column":39},"generated":{"line":2,"column":1275}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":64,"column":47},"generated":{"line":2,"column":1283}},{"source":"blockchain/block.js","name":"global","original":{"line":64,"column":61},"generated":{"line":2,"column":1295}},{"source":"blockchain/block.js","name":"config","original":{"line":64,"column":68},"generated":{"line":2,"column":1297}},{"source":"blockchain/block.js","name":"DIFFICULTY","original":{"line":64,"column":75},"generated":{"line":2,"column":1304}},{"source":"blockchain/block.js","name":"payload","original":{"line":65,"column":13},"generated":{"line":2,"column":1315}},{"source":"blockchain/block.js","name":"created_at","original":{"line":65,"column":21},"generated":{"line":2,"column":1317}},{"source":"blockchain/block.js","name":"lastBlock","original":{"line":65,"column":34},"generated":{"line":2,"column":1328}},{"source":"blockchain/block.js","name":"payload","original":{"line":65,"column":44},"generated":{"line":2,"column":1330}},{"source":"blockchain/block.js","name":"created_at","original":{"line":65,"column":52},"generated":{"line":2,"column":1338}},{"source":"blockchain/block.js","name":"global","original":{"line":65,"column":67},"generated":{"line":2,"column":1349}},{"source":"blockchain/block.js","name":"config","original":{"line":65,"column":74},"generated":{"line":2,"column":1351}},{"source":"blockchain/block.js","name":"MINE_RATE","original":{"line":65,"column":81},"generated":{"line":2,"column":1358}},{"source":"blockchain/block.js","name":"payload","original":{"line":67,"column":19},"generated":{"line":2,"column":1368}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":67,"column":27},"generated":{"line":2,"column":1370}},{"source":"blockchain/block.js","original":{"line":67,"column":40},"generated":{"line":2,"column":1381}},{"source":"blockchain/block.js","name":"payload","original":{"line":70,"column":13},"generated":{"line":2,"column":1383}},{"source":"blockchain/block.js","name":"created_at","original":{"line":70,"column":21},"generated":{"line":2,"column":1385}},{"source":"blockchain/block.js","name":"lastBlock","original":{"line":70,"column":34},"generated":{"line":2,"column":1396}},{"source":"blockchain/block.js","name":"payload","original":{"line":70,"column":44},"generated":{"line":2,"column":1398}},{"source":"blockchain/block.js","name":"created_at","original":{"line":70,"column":52},"generated":{"line":2,"column":1406}},{"source":"blockchain/block.js","name":"global","original":{"line":70,"column":67},"generated":{"line":2,"column":1417}},{"source":"blockchain/block.js","name":"config","original":{"line":70,"column":74},"generated":{"line":2,"column":1419}},{"source":"blockchain/block.js","name":"MINE_RATE","original":{"line":70,"column":81},"generated":{"line":2,"column":1426}},{"source":"blockchain/block.js","name":"payload","original":{"line":72,"column":19},"generated":{"line":2,"column":1436}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":72,"column":27},"generated":{"line":2,"column":1438}},{"source":"blockchain/block.js","original":{"line":72,"column":40},"generated":{"line":2,"column":1449}},{"source":"blockchain/block.js","original":{"line":75,"column":35},"generated":{"line":2,"column":1451}},{"source":"blockchain/block.js","name":"payload","original":{"line":75,"column":12},"generated":{"line":2,"column":1455}},{"source":"blockchain/block.js","name":"difficulty","original":{"line":75,"column":20},"generated":{"line":2,"column":1457}},{"source":"blockchain/block.js","name":"global","original":{"line":77,"column":20},"generated":{"line":2,"column":1468}},{"source":"blockchain/block.js","name":"config","original":{"line":77,"column":27},"generated":{"line":2,"column":1470}},{"source":"blockchain/block.js","name":"DIFFICULTY","original":{"line":77,"column":34},"generated":{"line":2,"column":1477}},{"source":"blockchain/block.js","name":"payload","original":{"line":75,"column":12},"generated":{"line":2,"column":1493}},{"source":"blockchain/block.js","original":{"line":84,"column":0},"generated":{"line":2,"column":1499}},{"source":"blockchain/block.js","name":"Block","original":{"line":8,"column":6},"generated":{"line":2,"column":1501}},{"source":"blockchain/block.js","name":"module","original":{"line":84,"column":0},"generated":{"line":2,"column":1504}},{"source":"blockchain/block.js","name":"exports","original":{"line":84,"column":7},"generated":{"line":2,"column":1511}},{"source":"blockchain/block.js","name":"Block","original":{"line":84,"column":17},"generated":{"line":2,"column":1519}}],"sources":{"blockchain/block.js":"const CryptUtil = require('../util/crypt');\nconst CRPYTO = require('crypto');\nconst HexToBin = require('hex-to-binary');\nconst LMDB = require('../util/database');\nlet DB = new LMDB().getInstance();\nconst { v1: uuid } = require('uuid');\n\nclass Block {\n\n    constructor({payload, hash}) {\n        \n        this.payload = payload;\n        this.payload.id = uuid();\n        this.hash = hash;\n\n    }\n\n    static genesis(){\n        return DB.transactionGenesisBlock();\n    }\n    /**\n     * Creates the initial block for the chain\n     * @returns \n     */\n    static getLastBlock(){\n        return new Promise((resolve, reject) => {\n            resolve(DB.transactionLastBlock())\n        }).catch( err => {\n            reject(err)\n        })\n    }\n\n    /**\n     * Appends new blocks to the chain\n     * @todo add dynamic diffculty based on time between blocks and using MINE_RATE\n     */\n    static mineBlock ( payload ){\n        return new Promise((resolve, reject) => {\n            let hash;\n            let lastBlock = DB.transactionLastBlock();\n            payload.id = uuid();\n            do {\n                payload.created_at = Date.now()\n                payload.nonce = CRPYTO.randomBytes(16).toString('base64');\n                payload.difficulty = Block.adjustDifficulty(payload, lastBlock);\n                payload.lastHash = lastBlock.hash\n                hash = CryptUtil.hash(payload, payload.difficulty, payload.nonce);\n            }while( HexToBin(hash).substr(0, payload.difficulty) !== '0'.repeat(payload.difficulty))\n            let block = {\n                payload : payload,\n                hash\n            }\n            resolve(DB.transactionPutBlock(block));\n        })\n        \n      \n    }\n    /**\n     * We want block to be mined at a constant rate. Evaluate the current time stamp - the lastBlock timestamp\n     * and adjust accordingly\n     */\n    static adjustDifficulty( payload, lastBlock ) {\n        let diff;\n        payload.difficulty = lastBlock.payload.difficulty || global.config.DIFFICULTY;\n        if(( payload.created_at - lastBlock.payload.created_at ) < global.config.MINE_RATE ){\n            //console.log('MINE RATE TOO FAST', payload.created_at - lastBlock.payload.created_at)\n            diff = payload.difficulty + 1\n            return diff;\n        }\n        if(( payload.created_at - lastBlock.payload.created_at ) > global.config.MINE_RATE ){\n            //console.log('MINE RATE TOO SLOW', payload.created_at - lastBlock.payload.created_at)\n            diff = payload.difficulty - 1\n            return diff;\n        }\n        if( payload.difficulty === 0 ){\n            //console.log('MINE RATE 0', payload.difficulty)\n            return  global.config.DIFFICULTY;\n        }\n        \n    }\n   \n}\n\nmodule.exports = Block;"},"lineCount":null}},"error":null,"hash":"c20abdab65a9f2f7f0663e941b98b690","cacheData":{"env":{}}}