{"id":"h5KC","dependencies":[{"name":"/home/hibberdk/Sites/XILOBYTE/variant/package.json","includedInParent":true,"mtime":1625901220329},{"name":"uuid","loc":{"line":1,"column":29},"parent":"/home/hibberdk/Sites/XILOBYTE/variant/wallet/transaction.js","resolved":"/home/hibberdk/Sites/XILOBYTE/variant/node_modules/uuid/index.js"},{"name":"../util/crypt","loc":{"line":2,"column":26},"parent":"/home/hibberdk/Sites/XILOBYTE/variant/wallet/transaction.js","resolved":"/home/hibberdk/Sites/XILOBYTE/variant/util/crypt.js"}],"generated":{"js":"function t(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function e(t,e){for(var u=0;u<e.length;u++){var a=e[u];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function u(t,u,a){return u&&e(t.prototype,u),a&&e(t,a),t}var a=require(\"uuid\"),n=a.v1,i=require(\"../util/crypt\"),r=function(){function e(u){var a=u.senderWallet,i=u.recipient,r=u.amount;t(this,e),this.id=n(),this.outputMap=this.createOutputMap({senderWallet:a,recipient:i,amount:r}),this.input=this.createInput({senderWallet:a,outputMap:this.outputMap}),this.publicKey=a.publicKey}return u(e,[{key:\"createOutputMap\",value:function(t){var e=t.senderWallet,u=t.recipient,a=t.amount,n={};return n[u]=a,n[e.publicKey]=e.balance-a,n}},{key:\"createInput\",value:function(t){var e=t.senderWallet,u=t.outputMap;return{timestamp:Date.now(),amount:e.balance,address:e.publicKey,signature:i.sign({payload:u,publicKey:e.publicKey})}}},{key:\"update\",value:function(t){var e=t.senderWallet,u=t.recipient,a=t.amount;if(a>this.outputMap[e.publicKey])throw new Error(\"Amount exceeds balance\");this.outputMap[u]?this.outputMap[u]=this.outputMap[u]+a:this.outputMap[u]=a,this.outputMap[e.publicKey]=this.outputMap[e.publicKey]-a,this.input=this.createInput({senderWallet:e,outputMap:this.outputMap})}}],[{key:\"validTransaction\",value:function(t){var e=t.input,u=e.address,a=e.amount,n=e.signature,r=t.outputMap,o=Object.values(r).reduce(function(t,e){return t+e});return a!==o?(console.error(\"INVALID TRANSACTION from wallet: \".concat(u,\". Transaction amount \").concat(a,\" !== outputTotal \").concat(o)),!1):!!i.verify({signature:n.signature,nonce:n.nonce,publicKey:t.publicKey})||(console.error(\"INVALID TRANSACTION from wallet: \".concat(u,\". Signature is invalid\")),!1)}}]),e}();module.exports=r;"},"sourceMaps":{"js":{"mappings":[{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":0}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":9}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":11}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":13}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":16}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":21}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":34}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":37}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":43}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":47}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":57}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":94}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":103}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":105}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":107}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":110}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":114}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":118}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":120}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":122}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":124}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":126}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":133}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":137}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":138}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":142}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":144}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":146}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":149}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":151}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":162}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":164}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":177}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":179}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":181}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":195}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":197}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":207}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":211}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":213}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":223}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":226}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":233}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":248}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":250}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":252}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":256}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":260}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":269}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":271}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":273}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":275}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":278}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":285}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":288}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":290}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":292}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":302}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":305}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":308}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":310}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":312}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":315}},{"source":"wallet/transaction.js","original":{"line":1,"column":0},"generated":{"line":1,"column":317}},{"source":"wallet/transaction.js","name":"require","original":{"line":1,"column":21},"generated":{"line":1,"column":321}},{"source":"wallet/transaction.js","name":"require","original":{"line":1,"column":21},"generated":{"line":1,"column":323}},{"source":"wallet/transaction.js","original":{"line":1,"column":29},"generated":{"line":1,"column":331}},{"source":"wallet/transaction.js","name":"uuid","original":{"line":1,"column":12},"generated":{"line":1,"column":339}},{"source":"wallet/transaction.js","name":"v1","original":{"line":1,"column":8},"generated":{"line":1,"column":341}},{"source":"wallet/transaction.js","name":"v1","original":{"line":1,"column":8},"generated":{"line":1,"column":343}},{"source":"wallet/transaction.js","name":"CryptUtil","original":{"line":2,"column":6},"generated":{"line":1,"column":346}},{"source":"wallet/transaction.js","name":"require","original":{"line":2,"column":18},"generated":{"line":1,"column":348}},{"source":"wallet/transaction.js","original":{"line":2,"column":26},"generated":{"line":1,"column":356}},{"source":"wallet/transaction.js","name":"Transaction","original":{"line":4,"column":6},"generated":{"line":1,"column":373}},{"source":"wallet/transaction.js","name":"Transaction","original":{"line":4,"column":6},"generated":{"line":1,"column":375}},{"source":"wallet/transaction.js","original":{"line":6,"column":50},"generated":{"line":1,"column":386}},{"source":"wallet/transaction.js","original":{"line":6,"column":50},"generated":{"line":1,"column":395}},{"source":"wallet/transaction.js","original":{"line":6,"column":50},"generated":{"line":1,"column":397}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":6,"column":17},"generated":{"line":1,"column":400}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":6,"column":17},"generated":{"line":1,"column":404}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":6,"column":17},"generated":{"line":1,"column":406}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":6,"column":17},"generated":{"line":1,"column":408}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":6,"column":31},"generated":{"line":1,"column":421}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":6,"column":31},"generated":{"line":1,"column":423}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":6,"column":31},"generated":{"line":1,"column":425}},{"source":"wallet/transaction.js","name":"amount","original":{"line":6,"column":42},"generated":{"line":1,"column":435}},{"source":"wallet/transaction.js","name":"amount","original":{"line":6,"column":42},"generated":{"line":1,"column":437}},{"source":"wallet/transaction.js","name":"amount","original":{"line":6,"column":42},"generated":{"line":1,"column":439}},{"source":"wallet/transaction.js","original":{"line":6,"column":50},"generated":{"line":1,"column":446}},{"source":"wallet/transaction.js","original":{"line":6,"column":50},"generated":{"line":1,"column":448}},{"source":"wallet/transaction.js","original":{"line":6,"column":50},"generated":{"line":1,"column":453}},{"source":"wallet/transaction.js","name":"id","original":{"line":7,"column":13},"generated":{"line":1,"column":456}},{"source":"wallet/transaction.js","name":"id","original":{"line":7,"column":13},"generated":{"line":1,"column":461}},{"source":"wallet/transaction.js","name":"uuid","original":{"line":7,"column":18},"generated":{"line":1,"column":464}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":8,"column":13},"generated":{"line":1,"column":468}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":8,"column":13},"generated":{"line":1,"column":473}},{"source":"wallet/transaction.js","original":{"line":8,"column":25},"generated":{"line":1,"column":483}},{"source":"wallet/transaction.js","name":"createOutputMap","original":{"line":8,"column":30},"generated":{"line":1,"column":488}},{"source":"wallet/transaction.js","original":{"line":8,"column":46},"generated":{"line":1,"column":504}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":8,"column":47},"generated":{"line":1,"column":505}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":8,"column":47},"generated":{"line":1,"column":518}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":8,"column":61},"generated":{"line":1,"column":520}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":8,"column":61},"generated":{"line":1,"column":530}},{"source":"wallet/transaction.js","name":"amount","original":{"line":8,"column":72},"generated":{"line":1,"column":532}},{"source":"wallet/transaction.js","name":"amount","original":{"line":8,"column":72},"generated":{"line":1,"column":539}},{"source":"wallet/transaction.js","name":"input","original":{"line":9,"column":13},"generated":{"line":1,"column":543}},{"source":"wallet/transaction.js","name":"input","original":{"line":9,"column":13},"generated":{"line":1,"column":548}},{"source":"wallet/transaction.js","original":{"line":9,"column":21},"generated":{"line":1,"column":554}},{"source":"wallet/transaction.js","name":"createInput","original":{"line":9,"column":26},"generated":{"line":1,"column":559}},{"source":"wallet/transaction.js","original":{"line":9,"column":38},"generated":{"line":1,"column":571}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":9,"column":39},"generated":{"line":1,"column":572}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":9,"column":39},"generated":{"line":1,"column":585}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":9,"column":53},"generated":{"line":1,"column":587}},{"source":"wallet/transaction.js","original":{"line":9,"column":64},"generated":{"line":1,"column":597}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":9,"column":69},"generated":{"line":1,"column":602}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":10,"column":13},"generated":{"line":1,"column":614}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":10,"column":13},"generated":{"line":1,"column":619}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":10,"column":25},"generated":{"line":1,"column":629}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":10,"column":38},"generated":{"line":1,"column":631}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":641}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":648}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":650}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":652}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":653}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":654}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":658}},{"source":"wallet/transaction.js","original":{"line":13,"column":4},"generated":{"line":1,"column":676}},{"source":"wallet/transaction.js","original":{"line":13,"column":4},"generated":{"line":1,"column":682}},{"source":"wallet/transaction.js","original":{"line":13,"column":54},"generated":{"line":1,"column":691}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":13,"column":21},"generated":{"line":1,"column":694}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":13,"column":21},"generated":{"line":1,"column":698}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":13,"column":21},"generated":{"line":1,"column":700}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":13,"column":21},"generated":{"line":1,"column":702}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":13,"column":35},"generated":{"line":1,"column":715}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":13,"column":35},"generated":{"line":1,"column":717}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":13,"column":35},"generated":{"line":1,"column":719}},{"source":"wallet/transaction.js","name":"amount","original":{"line":13,"column":46},"generated":{"line":1,"column":729}},{"source":"wallet/transaction.js","name":"amount","original":{"line":13,"column":46},"generated":{"line":1,"column":731}},{"source":"wallet/transaction.js","name":"amount","original":{"line":13,"column":46},"generated":{"line":1,"column":733}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":14,"column":14},"generated":{"line":1,"column":740}},{"source":"wallet/transaction.js","original":{"line":14,"column":26},"generated":{"line":1,"column":742}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":17,"column":15},"generated":{"line":1,"column":745}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":15,"column":8},"generated":{"line":1,"column":752}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":15,"column":18},"generated":{"line":1,"column":754}},{"source":"wallet/transaction.js","name":"amount","original":{"line":15,"column":31},"generated":{"line":1,"column":757}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":16,"column":8},"generated":{"line":1,"column":759}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":16,"column":18},"generated":{"line":1,"column":761}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":16,"column":31},"generated":{"line":1,"column":763}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":16,"column":44},"generated":{"line":1,"column":774}},{"source":"wallet/transaction.js","name":"balance","original":{"line":16,"column":57},"generated":{"line":1,"column":776}},{"source":"wallet/transaction.js","name":"amount","original":{"line":16,"column":67},"generated":{"line":1,"column":784}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":17,"column":15},"generated":{"line":1,"column":786}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":790}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":791}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":795}},{"source":"wallet/transaction.js","original":{"line":20,"column":4},"generated":{"line":1,"column":809}},{"source":"wallet/transaction.js","original":{"line":20,"column":4},"generated":{"line":1,"column":815}},{"source":"wallet/transaction.js","original":{"line":20,"column":42},"generated":{"line":1,"column":824}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":20,"column":17},"generated":{"line":1,"column":827}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":20,"column":17},"generated":{"line":1,"column":831}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":20,"column":17},"generated":{"line":1,"column":833}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":20,"column":17},"generated":{"line":1,"column":835}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":20,"column":31},"generated":{"line":1,"column":848}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":20,"column":31},"generated":{"line":1,"column":850}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":20,"column":31},"generated":{"line":1,"column":852}},{"source":"wallet/transaction.js","original":{"line":21,"column":15},"generated":{"line":1,"column":862}},{"source":"wallet/transaction.js","original":{"line":21,"column":15},"generated":{"line":1,"column":868}},{"source":"wallet/transaction.js","name":"timestamp","original":{"line":22,"column":12},"generated":{"line":1,"column":869}},{"source":"wallet/transaction.js","name":"Date","original":{"line":22,"column":23},"generated":{"line":1,"column":879}},{"source":"wallet/transaction.js","name":"now","original":{"line":22,"column":28},"generated":{"line":1,"column":884}},{"source":"wallet/transaction.js","name":"amount","original":{"line":23,"column":12},"generated":{"line":1,"column":890}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":23,"column":20},"generated":{"line":1,"column":897}},{"source":"wallet/transaction.js","name":"balance","original":{"line":23,"column":33},"generated":{"line":1,"column":899}},{"source":"wallet/transaction.js","name":"address","original":{"line":24,"column":12},"generated":{"line":1,"column":907}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":24,"column":21},"generated":{"line":1,"column":915}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":24,"column":34},"generated":{"line":1,"column":917}},{"source":"wallet/transaction.js","name":"signature","original":{"line":25,"column":12},"generated":{"line":1,"column":927}},{"source":"wallet/transaction.js","name":"CryptUtil","original":{"line":25,"column":23},"generated":{"line":1,"column":937}},{"source":"wallet/transaction.js","name":"sign","original":{"line":25,"column":33},"generated":{"line":1,"column":939}},{"source":"wallet/transaction.js","original":{"line":25,"column":38},"generated":{"line":1,"column":944}},{"source":"wallet/transaction.js","name":"payload","original":{"line":26,"column":14},"generated":{"line":1,"column":945}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":26,"column":23},"generated":{"line":1,"column":953}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":27,"column":14},"generated":{"line":1,"column":955}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":27,"column":25},"generated":{"line":1,"column":965}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":27,"column":38},"generated":{"line":1,"column":967}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":982}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":983}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":987}},{"source":"wallet/transaction.js","original":{"line":56,"column":4},"generated":{"line":1,"column":996}},{"source":"wallet/transaction.js","original":{"line":56,"column":4},"generated":{"line":1,"column":1002}},{"source":"wallet/transaction.js","original":{"line":56,"column":48},"generated":{"line":1,"column":1011}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":56,"column":13},"generated":{"line":1,"column":1014}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":56,"column":13},"generated":{"line":1,"column":1018}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":56,"column":13},"generated":{"line":1,"column":1020}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":56,"column":13},"generated":{"line":1,"column":1022}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":56,"column":27},"generated":{"line":1,"column":1035}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":56,"column":27},"generated":{"line":1,"column":1037}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":56,"column":27},"generated":{"line":1,"column":1039}},{"source":"wallet/transaction.js","name":"amount","original":{"line":56,"column":38},"generated":{"line":1,"column":1049}},{"source":"wallet/transaction.js","name":"amount","original":{"line":56,"column":38},"generated":{"line":1,"column":1051}},{"source":"wallet/transaction.js","name":"amount","original":{"line":56,"column":38},"generated":{"line":1,"column":1053}},{"source":"wallet/transaction.js","name":"amount","original":{"line":57,"column":12},"generated":{"line":1,"column":1060}},{"source":"wallet/transaction.js","name":"amount","original":{"line":57,"column":12},"generated":{"line":1,"column":1063}},{"source":"wallet/transaction.js","original":{"line":57,"column":21},"generated":{"line":1,"column":1065}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":57,"column":26},"generated":{"line":1,"column":1070}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":57,"column":36},"generated":{"line":1,"column":1080}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":57,"column":49},"generated":{"line":1,"column":1082}},{"source":"wallet/transaction.js","original":{"line":58,"column":16},"generated":{"line":1,"column":1093}},{"source":"wallet/transaction.js","original":{"line":58,"column":16},"generated":{"line":1,"column":1099}},{"source":"wallet/transaction.js","name":"Error","original":{"line":58,"column":20},"generated":{"line":1,"column":1103}},{"source":"wallet/transaction.js","original":{"line":58,"column":26},"generated":{"line":1,"column":1109}},{"source":"wallet/transaction.js","original":{"line":61,"column":13},"generated":{"line":1,"column":1135}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":61,"column":18},"generated":{"line":1,"column":1140}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":61,"column":28},"generated":{"line":1,"column":1150}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":64,"column":15},"generated":{"line":1,"column":1153}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":64,"column":15},"generated":{"line":1,"column":1158}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":64,"column":25},"generated":{"line":1,"column":1168}},{"source":"wallet/transaction.js","original":{"line":64,"column":38},"generated":{"line":1,"column":1171}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":64,"column":43},"generated":{"line":1,"column":1176}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":64,"column":53},"generated":{"line":1,"column":1186}},{"source":"wallet/transaction.js","name":"amount","original":{"line":64,"column":66},"generated":{"line":1,"column":1189}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":62,"column":15},"generated":{"line":1,"column":1191}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":62,"column":15},"generated":{"line":1,"column":1196}},{"source":"wallet/transaction.js","name":"recipient","original":{"line":62,"column":25},"generated":{"line":1,"column":1206}},{"source":"wallet/transaction.js","name":"amount","original":{"line":62,"column":38},"generated":{"line":1,"column":1209}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":67,"column":13},"generated":{"line":1,"column":1211}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":67,"column":13},"generated":{"line":1,"column":1216}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":67,"column":23},"generated":{"line":1,"column":1226}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":67,"column":36},"generated":{"line":1,"column":1228}},{"source":"wallet/transaction.js","original":{"line":68,"column":10},"generated":{"line":1,"column":1239}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":68,"column":15},"generated":{"line":1,"column":1244}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":68,"column":25},"generated":{"line":1,"column":1254}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":68,"column":38},"generated":{"line":1,"column":1256}},{"source":"wallet/transaction.js","name":"amount","original":{"line":68,"column":51},"generated":{"line":1,"column":1267}},{"source":"wallet/transaction.js","name":"input","original":{"line":70,"column":13},"generated":{"line":1,"column":1269}},{"source":"wallet/transaction.js","name":"input","original":{"line":70,"column":13},"generated":{"line":1,"column":1274}},{"source":"wallet/transaction.js","original":{"line":70,"column":21},"generated":{"line":1,"column":1280}},{"source":"wallet/transaction.js","name":"createInput","original":{"line":70,"column":26},"generated":{"line":1,"column":1285}},{"source":"wallet/transaction.js","original":{"line":70,"column":38},"generated":{"line":1,"column":1297}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":70,"column":40},"generated":{"line":1,"column":1298}},{"source":"wallet/transaction.js","name":"senderWallet","original":{"line":70,"column":40},"generated":{"line":1,"column":1311}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":70,"column":54},"generated":{"line":1,"column":1313}},{"source":"wallet/transaction.js","original":{"line":70,"column":65},"generated":{"line":1,"column":1323}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":70,"column":70},"generated":{"line":1,"column":1328}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":1343}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":1344}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":1345}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":1349}},{"source":"wallet/transaction.js","original":{"line":32,"column":4},"generated":{"line":1,"column":1368}},{"source":"wallet/transaction.js","original":{"line":32,"column":4},"generated":{"line":1,"column":1374}},{"source":"wallet/transaction.js","name":"transaction","original":{"line":32,"column":28},"generated":{"line":1,"column":1383}},{"source":"wallet/transaction.js","name":"transaction","original":{"line":34,"column":65},"generated":{"line":1,"column":1386}},{"source":"wallet/transaction.js","name":"transaction","original":{"line":34,"column":65},"generated":{"line":1,"column":1390}},{"source":"wallet/transaction.js","name":"transaction","original":{"line":34,"column":65},"generated":{"line":1,"column":1392}},{"source":"wallet/transaction.js","name":"input","original":{"line":34,"column":15},"generated":{"line":1,"column":1394}},{"source":"wallet/transaction.js","name":"address","original":{"line":34,"column":23},"generated":{"line":1,"column":1400}},{"source":"wallet/transaction.js","name":"address","original":{"line":34,"column":23},"generated":{"line":1,"column":1402}},{"source":"wallet/transaction.js","name":"address","original":{"line":34,"column":23},"generated":{"line":1,"column":1404}},{"source":"wallet/transaction.js","name":"amount","original":{"line":34,"column":32},"generated":{"line":1,"column":1412}},{"source":"wallet/transaction.js","name":"amount","original":{"line":34,"column":32},"generated":{"line":1,"column":1414}},{"source":"wallet/transaction.js","name":"amount","original":{"line":34,"column":32},"generated":{"line":1,"column":1416}},{"source":"wallet/transaction.js","name":"signature","original":{"line":34,"column":40},"generated":{"line":1,"column":1423}},{"source":"wallet/transaction.js","name":"signature","original":{"line":34,"column":40},"generated":{"line":1,"column":1425}},{"source":"wallet/transaction.js","name":"signature","original":{"line":34,"column":40},"generated":{"line":1,"column":1427}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":34,"column":52},"generated":{"line":1,"column":1437}},{"source":"wallet/transaction.js","name":"transaction","original":{"line":34,"column":65},"generated":{"line":1,"column":1439}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":34,"column":52},"generated":{"line":1,"column":1441}},{"source":"wallet/transaction.js","name":"outputTotal","original":{"line":35,"column":14},"generated":{"line":1,"column":1451}},{"source":"wallet/transaction.js","name":"Object","original":{"line":35,"column":28},"generated":{"line":1,"column":1453}},{"source":"wallet/transaction.js","name":"values","original":{"line":35,"column":35},"generated":{"line":1,"column":1460}},{"source":"wallet/transaction.js","name":"outputMap","original":{"line":35,"column":42},"generated":{"line":1,"column":1467}},{"source":"wallet/transaction.js","name":"reduce","original":{"line":36,"column":9},"generated":{"line":1,"column":1470}},{"source":"wallet/transaction.js","original":{"line":36,"column":16},"generated":{"line":1,"column":1477}},{"source":"wallet/transaction.js","name":"total","original":{"line":36,"column":17},"generated":{"line":1,"column":1486}},{"source":"wallet/transaction.js","name":"outputAmount","original":{"line":36,"column":24},"generated":{"line":1,"column":1488}},{"source":"wallet/transaction.js","name":"total","original":{"line":36,"column":41},"generated":{"line":1,"column":1491}},{"source":"wallet/transaction.js","name":"total","original":{"line":36,"column":41},"generated":{"line":1,"column":1498}},{"source":"wallet/transaction.js","name":"outputAmount","original":{"line":36,"column":49},"generated":{"line":1,"column":1500}},{"source":"wallet/transaction.js","name":"amount","original":{"line":38,"column":11},"generated":{"line":1,"column":1504}},{"source":"wallet/transaction.js","name":"amount","original":{"line":38,"column":11},"generated":{"line":1,"column":1511}},{"source":"wallet/transaction.js","name":"outputTotal","original":{"line":38,"column":22},"generated":{"line":1,"column":1515}},{"source":"wallet/transaction.js","name":"console","original":{"line":39,"column":12},"generated":{"line":1,"column":1518}},{"source":"wallet/transaction.js","name":"error","original":{"line":39,"column":20},"generated":{"line":1,"column":1526}},{"source":"wallet/transaction.js","name":"address","original":{"line":39,"column":62},"generated":{"line":1,"column":1532}},{"source":"wallet/transaction.js","name":"address","original":{"line":39,"column":62},"generated":{"line":1,"column":1568}},{"source":"wallet/transaction.js","name":"address","original":{"line":39,"column":62},"generated":{"line":1,"column":1575}},{"source":"wallet/transaction.js","name":"amount","original":{"line":39,"column":93},"generated":{"line":1,"column":1577}},{"source":"wallet/transaction.js","name":"amount","original":{"line":39,"column":93},"generated":{"line":1,"column":1602}},{"source":"wallet/transaction.js","name":"amount","original":{"line":39,"column":93},"generated":{"line":1,"column":1609}},{"source":"wallet/transaction.js","name":"outputTotal","original":{"line":39,"column":119},"generated":{"line":1,"column":1611}},{"source":"wallet/transaction.js","name":"outputTotal","original":{"line":39,"column":119},"generated":{"line":1,"column":1632}},{"source":"wallet/transaction.js","name":"outputTotal","original":{"line":39,"column":119},"generated":{"line":1,"column":1639}},{"source":"wallet/transaction.js","original":{"line":40,"column":19},"generated":{"line":1,"column":1644}},{"source":"wallet/transaction.js","name":"CryptUtil","original":{"line":42,"column":12},"generated":{"line":1,"column":1649}},{"source":"wallet/transaction.js","name":"verify","original":{"line":42,"column":22},"generated":{"line":1,"column":1651}},{"source":"wallet/transaction.js","original":{"line":42,"column":29},"generated":{"line":1,"column":1658}},{"source":"wallet/transaction.js","name":"signature","original":{"line":42,"column":30},"generated":{"line":1,"column":1659}},{"source":"wallet/transaction.js","name":"signature","original":{"line":42,"column":41},"generated":{"line":1,"column":1669}},{"source":"wallet/transaction.js","name":"signature","original":{"line":42,"column":51},"generated":{"line":1,"column":1671}},{"source":"wallet/transaction.js","name":"nonce","original":{"line":42,"column":62},"generated":{"line":1,"column":1681}},{"source":"wallet/transaction.js","name":"signature","original":{"line":42,"column":69},"generated":{"line":1,"column":1687}},{"source":"wallet/transaction.js","name":"nonce","original":{"line":42,"column":79},"generated":{"line":1,"column":1689}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":42,"column":86},"generated":{"line":1,"column":1695}},{"source":"wallet/transaction.js","name":"transaction","original":{"line":42,"column":97},"generated":{"line":1,"column":1705}},{"source":"wallet/transaction.js","name":"publicKey","original":{"line":42,"column":109},"generated":{"line":1,"column":1707}},{"source":"wallet/transaction.js","name":"console","original":{"line":43,"column":10},"generated":{"line":1,"column":1721}},{"source":"wallet/transaction.js","name":"error","original":{"line":43,"column":18},"generated":{"line":1,"column":1729}},{"source":"wallet/transaction.js","name":"address","original":{"line":43,"column":60},"generated":{"line":1,"column":1735}},{"source":"wallet/transaction.js","name":"address","original":{"line":43,"column":60},"generated":{"line":1,"column":1771}},{"source":"wallet/transaction.js","name":"address","original":{"line":43,"column":60},"generated":{"line":1,"column":1778}},{"source":"wallet/transaction.js","original":{"line":43,"column":10},"generated":{"line":1,"column":1780}},{"source":"wallet/transaction.js","original":{"line":44,"column":17},"generated":{"line":1,"column":1808}},{"source":"wallet/transaction.js","original":{"line":75,"column":0},"generated":{"line":1,"column":1815}},{"source":"wallet/transaction.js","name":"Transaction","original":{"line":4,"column":6},"generated":{"line":1,"column":1817}},{"source":"wallet/transaction.js","name":"module","original":{"line":75,"column":0},"generated":{"line":1,"column":1820}},{"source":"wallet/transaction.js","name":"exports","original":{"line":75,"column":7},"generated":{"line":1,"column":1827}},{"source":"wallet/transaction.js","name":"Transaction","original":{"line":75,"column":17},"generated":{"line":1,"column":1835}}],"sources":{"wallet/transaction.js":"const { v1: uuid } = require('uuid');\nconst CryptUtil = require('../util/crypt');\n\nclass Transaction {\n\n    constructor({senderWallet, recipient, amount}){\n        this.id = uuid();\n        this.outputMap = this.createOutputMap({senderWallet, recipient, amount});\n        this.input = this.createInput({senderWallet, outputMap: this.outputMap});\n        this.publicKey = senderWallet.publicKey\n    }\n\n    createOutputMap({senderWallet, recipient, amount}){\n        const outputMap = {};\n        outputMap[recipient] = amount;\n        outputMap[senderWallet.publicKey] = senderWallet.balance - amount;\n        return outputMap;\n    }\n\n    createInput({senderWallet, outputMap}){\n        return {\n            timestamp: Date.now(),\n            amount: senderWallet.balance,\n            address: senderWallet.publicKey,\n            signature: CryptUtil.sign({\n              payload: outputMap, \n              publicKey: senderWallet.publicKey\n            })\n        }\n    }\n\n    static validTransaction(transaction){\n\n        const {input: {address, amount, signature}, outputMap} = transaction;\n        const outputTotal = Object.values(outputMap)\n        .reduce((total, outputAmount) => total + outputAmount);\n  \n        if(amount !== outputTotal){\n            console.error(`INVALID TRANSACTION from wallet: ${address}. Transaction amount ${amount} !== outputTotal ${outputTotal}`);\n            return false;\n        }\n        if(!CryptUtil.verify({signature: signature.signature, nonce: signature.nonce, publicKey: transaction.publicKey})){\n          console.error(`INVALID TRANSACTION from wallet: ${address}. Signature is invalid`);\n          return false;\n        }\n\n        /** \n        if(!verifySignature({publicKey: address, data: outputMap, signature})){\n            console.error(`INVALID TRANSACTION from wallet: ${address}. Signature is invalid`);\n            return false;\n        }\n        **/\n        return true;\n    }\n\n    update({ senderWallet, recipient, amount }) {\n        if (amount > this.outputMap[senderWallet.publicKey]) {\n          throw new Error('Amount exceeds balance');\n        }\n    \n        if (!this.outputMap[recipient]) {\n          this.outputMap[recipient] = amount;\n        } else {\n          this.outputMap[recipient] = this.outputMap[recipient] + amount;\n        }\n    \n        this.outputMap[senderWallet.publicKey] =\n          this.outputMap[senderWallet.publicKey] - amount;\n    \n        this.input = this.createInput({ senderWallet, outputMap: this.outputMap });\n      }\n    \n}\n\nmodule.exports = Transaction;"},"lineCount":null}},"error":null,"hash":"18e3c71c791779e696aaaadf94ddff53","cacheData":{"env":{}}}